\chapter{Request- en Response-queries}%
\label{ch:HTTP-queries}

\clearpage

\section{Query 1: Domeinen opvragen}

\subsection{Azure AD Graph}

\subsubsection{Request}

\begin{itemize}
    \item \Ac{HTTP}-method: GET
    \item \ac{URL}: https://graph.windows.net/ffa43659-...-838af35d1353/domains
    \item \Ac{API}-version: 1.6
\end{itemize}

\subsubsection{Response body}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=1.2mm,
        baselinestretch=1.2,
        fontsize=\scriptsize,
        linenos
        ]  
        {json}
{
    "odata.metadata": "https://graph.windows.net/ffa43659-...-838af35d1353/$metadata#domains",
    "value": [
    {
        "authenticationType": "Managed",
        "availabilityStatus": null,
        "isAdminManaged": true,
        "isDefault": true,
        "isDefaultForCloudRedirections": false,
        "isInitial": true,
        "isRoot": true,
        "isVerified": true,
        "name": "25ky3d.onmicrosoft.com",
        "supportedServices": ["Email", "OfficeCommunicationsOnline"],
        "forceDeleteState": null,
        "state": null,
        "passwordValidityPeriodInDays": 2147483647,
        "passwordNotificationWindowInDays": 14
    }
    ]
}
    \end{minted}
    \caption[Query 1: Response body Azure AD Graph]{Response body van de eerste query via Azure \ac{AD} Graph Explorer.}
    \label{Q1AADRB}
\end{listing}

%\clearpage

\subsubsection{Response header}

\begin{listing}[ht]
    \begin{minted}
        [
        frame=lines,
        framesep=1.2mm,
        baselinestretch=1.2,
        fontsize=\scriptsize,
        linenos
        ]  
        {json}
{
    "cache-control": "no-cache",
    "client-request-id": "82bc7ed4-db42-414f-8260-73754bca7ce1",
    "content-length": "504",
    "content-type": "application/json; odata=minimalmetadata; streaming=true; charset=utf-8",
    "expires": "-1",
    "ocp-aad-session-key": "fdBtvCAl-..._n1UQvQe9reWesQHDTlUo",
    "pragma": "no-cache",
    "request-id": "dfd33cc1-ca0e-4964-ae48-0d3f6f222514"
}
    \end{minted}
    \caption[Query 1: Response header Azure AD Graph]{Response header van de eerste query via Azure \ac{AD} Graph Explorer.}
    \label{Q1AADRH}
\end{listing}

\subsection{Microsoft Graph}

\subsubsection{Request}

\begin{itemize}
    \item \Ac{HTTP}-method: GET
    \item \Ac{API}-version: 1.0
    \item \ac{URL}: https://graph.microsoft.com/v1.0/domains
\end{itemize}

\subsubsection{Response body}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=1.2mm,
        baselinestretch=1.2,
        fontsize=\scriptsize,
        linenos
        ]  
        {json}
{
    "@odata.context": "https://graph.microsoft.com/v1.0/$metadata#domains",
    "value": [
    {
        "authenticationType": "Managed",
        "availabilityStatus": null,
        "id": "25ky3d.onmicrosoft.com",
        "isAdminManaged": true,
        "isDefault": true,
        "isInitial": true,
        "isRoot": true,
        "isVerified": true,
        "supportedServices": ["Email", "OfficeCommunicationsOnline"],
        "passwordValidityPeriodInDays": 2147483647,
        "passwordNotificationWindowInDays": 14,
        "state": null
    }
    ]
}
    \end{minted}
    \caption[Query 1: Response body Microsoft Graph]{Response body van de eerste query via Microsoft Graph Explorer.}
    \label{Q1MSGRB}
\end{listing}

\subsubsection{Response header}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=1.2mm,
        baselinestretch=1.2,
        fontsize=\scriptsize,
        linenos
        ]  
        {json}
{
    "cache-control": "no-cache",
    "client-request-id": "45bd0201-69d2-f78c-cee8-aaedfce8b3d8",
    "content-type": "application/json;odata.metadata=minimal;odata.streaming=true;
        IEEE754Compatible=false;charset=utf-8",
    "request-id": "0f814559-7945-48c7-bb2c-a5929a768b32"
}
    \end{minted}
    \caption[Query 1: Response header Microsoft Graph]{Response van de eerste query via Microsoft Graph Explorer.}
    \label{Q1MSGRH}
\end{listing}

\clearpage

\section{Query 2: Gebruiker aanmaken}

\subsection{Azure AD Graph}

\subsubsection{Request}

\begin{itemize}
    \item \Ac{HTTP}-method: POST
    \item \ac{URL}: https://graph.windows.net/ffa43659-...-838af35d1353/users
    \item \Ac{API}-version: 1.6
\end{itemize}

\subsubsection{Request body}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=1.2mm,
        baselinestretch=1.2,
        fontsize=\scriptsize,
        linenos
        ]  
        {json}
{
    "accountEnabled": true,
    "displayName": "Alex Wu",
    "mailNickname": "AlexW",
    "passwordProfile": {
        "password": "Test1234",
        "forceChangePasswordNextLogin": false
    },
    "userPrincipalName": "Alex@25ky3d.onmicrosoft.com"
}
    \end{minted}
    \caption[Query 2: Request body Microsoft Graph]{Request body van de tweede query via Azure \Ac{AD} Graph Explorer.}
    \label{Q2AADRQB}
\end{listing}

\clearpage

\subsubsection{Response body}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=1.2mm,
        baselinestretch=1.2,
        fontsize=\tiny,
        linenos
        ]  
        {json}
{
    "odata.metadata":  "https://graph.windows.net/ffa43659-...-838af35d1353/$metadata#directoryObjects/@Element",
    "odata.type": "Microsoft.DirectoryServices.User",
    "objectType": "User",
    "objectId": "5c9ab483-c9b4-4ab3-a857-4763c055ef53",
    "deletionTimestamp": null,
    "accountEnabled": true,
    "ageGroup": null,
    "assignedLicenses": [],
    "assignedPlans": [],
    "city": null,
    "companyName": null,
    "consentProvidedForMinor": null,
    "country": null,
    "createdDateTime": null,
    "creationType": null,
    "department": null,
    "dirSyncEnabled": null,
    "displayName": "Alex Wu",
    "employeeId": null,
    "facsimileTelephoneNumber": null,
    "givenName": null,
    "immutableId": null,
    "isCompromised": null,
    "jobTitle": null,
    "lastDirSyncTime": null,
    "legalAgeGroupClassification": null,
    "mail": null,
    "mailNickname": "AlexW",
    "mobile": null,
    "onPremisesDistinguishedName": null,
    "onPremisesSecurityIdentifier": null,
    "otherMails": [],
    "passwordPolicies": null,
    "passwordProfile": null,
    "physicalDeliveryOfficeName": null,
    "postalCode": null,
    "preferredLanguage": null,
    "provisionedPlans": [],
    "provisioningErrors": [],
    "proxyAddresses": [],
    "refreshTokensValidFromDateTime": "2023-05-06T10:53:45.6717827Z",
    "showInAddressList": null,
    "signInNames": [],
    "sipProxyAddress": null,
    "state": null,
    "streetAddress": null,
    "surname": null,
    "telephoneNumber": null,
    "usageLocation": null,
    "userIdentities": [],
    "userPrincipalName": "Alex@25ky3d.onmicrosoft.com",
    "userState": null,
    "userStateChangedOn": null,
    "userType": "Member"
}
    \end{minted}
    \caption[Query 2: Response body Microsoft Graph]{Response body van de tweede query via Azure \Ac{AD} Graph Explorer.}
    \label{Q2AADRB}
\end{listing}

\clearpage

\subsubsection{Response header}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=1.2mm,
        baselinestretch=1.2,
        fontsize=\scriptsize,
        linenos
        ]  
        {json}
{
    "cache-control": "no-cache",
    "client-request-id": "b47a729f-c944-44a1-a6a3-5f9d84b0b73f",
    "content-length": "1387",
    "content-type": "application/json; odata=minimalmetadata; streaming=true; charset=utf-8",
    "expires": "-1",
    "ocp-aad-session-key": "EYQrEhc2N...S1buL6cO8",
    "pragma": "no-cache",
    "request-id": "40d52611-5733-411b-aa59-1e76643a6ff4"
}
    \end{minted}
    \caption[Query 2: Response header Microsoft Graph]{Response header van de tweede query via Azure \Ac{AD} Graph Explorer.}
    \label{Q2AADRH}
\end{listing}

\subsection{Microsoft Graph}

\subsubsection{Request}

\begin{itemize}
    \item \Ac{HTTP}-method: POST
    \item \ac{API}-version: 1.0
    \item \Ac{URL}: https://graph.microsoft.com/v1.0/users
\end{itemize}

\subsubsection{Request body}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=1.2mm,
        baselinestretch=1.2,
        fontsize=\scriptsize,
        linenos
        ]  
        {json}
{
    "accountEnabled": true,
    "displayName": "Alex Wu",
    "mailNickname": "AlexW",
    "passwordProfile": {
        "password": "Test1234",
        "forceChangePasswordNextSignin": false
    },
    "userPrincipalName": "Alex@25ky3d.onmicrosoft.com"
}
    \end{minted}
    \caption[Query 2: Request body Microsoft Graph]{Request body van de tweede query via Microsoft Graph Explorer.}
    \label{Q2MSGRQB}
\end{listing}

\clearpage

\subsubsection{Response body}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=1.2mm,
        baselinestretch=1.2,
        fontsize=\scriptsize,
        linenos
        ]  
        {json}
{
    "@odata.context": "https://graph.microsoft.com/v1.0/$metadata#users/$entity",
    "id": "bc521ac5-ab90-4427-880d-c1c52ffe3ee7",
    "businessPhones": [],
    "displayName": "Alex Wu",
    "givenName": null,
    "jobTitle": null,
    "mail": null,
    "mobilePhone": null,
    "officeLocation": null,
    "preferredLanguage": null,
    "surname": null,
    "userPrincipalName": "Alex@25ky3d.onmicrosoft.com"
}
    \end{minted}
    \caption[Query 2: Response body Microsoft Graph]{Response body van de tweede query via Microsoft Graph Explorer.}
    \label{Q2MSGRB}
\end{listing}

\subsubsection{Response header}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=1.2mm,
        baselinestretch=1.2,
        fontsize=\scriptsize,
        linenos
        ]  
        {json}
{
    "cache-control": "no-cache",
    "client-request-id": "dce37693-434c-e47b-0cf5-b08bc11752fb",
    "content-type": "application/json;odata.metadata=minimal;
        odata.streaming=true;IEEE754Compatible=false;charset=utf-8",
    "location": "https://graph.microsoft.com/v2/ffa43659-...-838af35d1353/directoryObjects/
        bc521ac5-...-c1c52ffe3ee7/Microsoft.DirectoryServices.User",
    "request-id": "fab6e8dc-c90c-4377-a54f-b67034f3a07e"
}
    \end{minted}
    \caption[Query 2: Response header Microsoft Graph]{Response header van de tweede query via Microsoft Graph Explorer.}
    \label{Q2MSGRH}
\end{listing}

\clearpage

\section{Query 3: Gebruiker aanpassen}

\subsection{Azure AD Graph}

\subsubsection{Request}

\begin{itemize}
    \item \Ac{HTTP}-method: PATCH
    \item \ac{URL}: https://graph.windows.net/ffa...353/users/Alex@25ky3d.onmicrosoft.com
    \item \Ac{API}-version: 1.6
\end{itemize}

\subsubsection{Request body}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=1.2mm,
        baselinestretch=1.2,
        fontsize=\scriptsize,
        linenos
        ]  
        {json}
{
    "displayName": "Alex A. Wu"
}
    \end{minted}
    \caption[Query 3: Request body Azure AD Graph]{Request body van de derde query via Azure \Ac{AD} Graph Explorer.}
    \label{Q3AADRQB}
\end{listing}

\subsubsection{Response}

Geen response beschikbaar. Bij een PATCH-request wordt er bij een succesvolle verwerking geen response meegegeven. Als bewijs dat de query werd uitgevoerd kan Figuur \ref{Q3Proof} geraadpleegd worden. Op de foto is te zien dat de gebruiker “Alex Wu” wordt aangepast naar “Alex A. Wu”. \\ 

\begin{figure}[h]
    \includegraphics[width=\textwidth]{Q3Proof.png}
    \caption[Query 3: Bewijs van uitvoering]{Het resultaat van de uitgevoerde derde query in de testomgeving.}
    \label{Q3Proof}
\end{figure}

\subsection{Microsoft Graph}

\subsubsection{Request}

\begin{itemize}
    \item \Ac{HTTP}-method: PATCH
    \item \ac{API}-version: 1.0
    \item \Ac{URL}: https://graph.microsoft.com/v1.0/users/\{407074b1-...-41b76fbd7b67\}
\end{itemize}

\subsubsection{Request body}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=1.2mm,
        baselinestretch=1.2,
        fontsize=\scriptsize,
        linenos
        ]  
        {json}
{
    "displayName": "Alex A. Wu"
}
    \end{minted}
    \caption[Query 3: Request body Microsoft Graph]{Request body van de derde query via Microsoft Graph Explorer.}
    \label{Q3MSGRQB}
\end{listing}

\subsubsection{Response}

Geen response beschikbaar. Bij een PATCH-request wordt er bij een succesvolle verwerking geen response meegegeven. Als bewijs dat de query werd uitgevoerd kan Figuur \ref{Q3Proof} geraadpleegd worden. Op de foto is te zien dat de gebruiker “Alex Wu” wordt aangepast naar “Alex A. Wu”. \\

\clearpage

\section{Query 4: Gebruiker verwijderen}

\subsection{Azure AD Graph}

\subsubsection{Request}

\begin{itemize}
    \item \Ac{HTTP}-method: DELETE
    \item \ac{URL}: https://graph.windows.net/ffa...353/users/Alex@25ky3d.onmicrosoft.com
    \item \Ac{API}-version: 1.6
\end{itemize}

\subsubsection{Response}

Geen response beschikbaar. Bij een DELETE-request wordt er bij een succesvolle verwerking geen response meegegeven. Als bewijs dat de query werd uitgevoerd kan Figuur \ref{Q4Proof} geraadpleegd worden. Op de foto is te zien dat de gebruiker “Alex A. Wu” niet wordt weergegeven wanneer er alfabetisch wordt gesorteerd op de gebruikers. \\ 

\begin{figure}[h]
    \includegraphics[width=\textwidth]{Q4Proof.png}
    \caption[Query 4: Bewijs van uitvoering]{Het resultaat van de uitgevoerde vierde query in de testomgeving.}
    \label{Q4Proof}
\end{figure}

\subsection{Microsoft Graph}

\subsubsection{Request}

\begin{itemize}
    \item \Ac{HTTP}-method: DELETE
    \item \ac{API}-version: 1.0
    \item \Ac{URL}: https://graph.microsoft.com/v1.0/users/\{407074b1-...-41b76fbd7b67\}
\end{itemize}

\subsubsection{Response}

Geen response beschikbaar. Bij een DELETE-request wordt er bij een succesvolle verwerking geen response meegegeven. Als bewijs dat de query werd uitgevoerd kan Figuur \ref{Q4Proof} geraadpleegd worden. Op de foto is te zien dat de gebruiker “Alex A. Wu” niet wordt weergegeven wanneer er alfabetisch wordt gesorteerd op de gebruikers. 

% ---
% CHAPTER
% ---

\chapter{Microsoft Graph PowerShell-scripts}%
\label{ch:PowerShell-scripts}

\clearpage

\section{Connectie met Microsoft Graph}

\subsection{PowerShell-script: connectMSgraph.ps1}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=1.2mm,
        baselinestretch=1.2,
        fontsize=\tiny,
        linenos
        ]  
        {powershell}
# Applicatie-ID van de Azure AD-toepassing.
$AppId = 'c508b8a1-a1cd-4979-a51e-ddbcba517f89'

# ID van de Azure AD-tenant waar de toepassing is geregistreerd.
$TenantId = 'ffa43659-6d7d-4f83-a517-838af35d1353'

# Het clientgeheim voor de toepassing.
$ClientSecret = 'lKI8Q~a7~aZa.2O_xX7b5LMdFEtiqFqNgXntObgP'

# De MSAL PowerShell-module om een toegangstoken te verkrijgen voor de toepassing.
$Token = Get-MsalToken -TenantId $TenantId -ClientId $AppId `
    -ClientSecret ($ClientSecret | ConvertTo-SecureString -AsPlainText -Force)

# Verbinding maken met de Microsoft Graph API via de toegangstoken.
Connect-Graph -AccessToken $Token.AccessToken
    \end{minted}
    \caption[connectMSGraph.ps1]{PowerShell-script om te connecteren met Microsoft Graph als applicatie aan de hand van \ac{MSAL} door \textcite{Terlisten2022}.}
    \label{PSQ0}
\end{listing}

\subsection{Output}

\begin{verbatim}
Welcome To Microsoft Graph!
\end{verbatim}

\clearpage

\section{Functie 1: Aantal aanwezige domeinen binnen de Office 365-omgeving}

\subsection{PowerShell-script: functie1.ps1}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=1.2mm,
        baselinestretch=1.2,
        fontsize=\tiny,
        linenos
        ]  
        {powershell}
# Haalt een lijst van alle domeinen op die beschikbaar zijn in de Office 365-omgeving.
# Sla de Id en de AvailabilityStatus op van elk domein op in de variabele $domains.
$domains = (Get-MgDomain -Select Id,AvailabilityStatus)

Write-Host "=== Domains ==="

# Maakt een loop waarin elk domein in de $domains variabele wordt verwerkt. 
# Voor elk domein controleert de loop of de AvailabilityStatus waarde van het domein beschikbaar is of niet.
foreach ($domain in $domains) {
    if ($domain.AvailabilityStatus) 
        { Write-Host "Domain: $($domain.Id) - Status: $($domain.AvailabilityStatus)" }
    else { Write-Host "Domain: $($domain.Id) - Status: Not available" }
}

Write-Host "GRAND TOTAL: $($domains.count)"
    \end{minted}
    \caption[functie1.ps1]{Microsoft Graph PowerShell-script dat het aantal aanwezige domeinen binnen de omgeving weergeeft.}
    \label{PSQ1}
\end{listing}

\subsection{Output}

\begin{verbatim}
=== Domains ===
Domain: 25ky3d.onmicrosoft.com - Status: Not available
GRAND TOTAL: 1
\end{verbatim}

\clearpage

\section{Functie 2: Aantal gebruikers binnen de omgeving, onderverdeeld in interne en externe gebruikers}

\subsection{PowerShell-script: functie2.ps1}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=1.2mm,
        baselinestretch=1.2,
        fontsize=\tiny,
        linenos
        ]  
        {powershell}
# Haalt een lijst van alle gebruikers op die beschikbaar zijn in de Office 365-omgeving.
# Het slaat de UserPrincipalName, OnPremisesSyncEnabled en UserType van elke gebruiker op in de variabele $users.
$users = (Get-MgUser -Select UserPrincipalName,OnPremisesSyncEnabled,UserType)

# Initialiseert de tellers voor de verschillende soorten gebruikers.
$syncedCount = $cloudCount = $memberCount = $guestCount = 0

# Begint een loop waarin elk gebruiker in de $users variabele wordt verwerkt. 
# Voor elke gebruiker wordt de UserPrincipalName getoond en gecontroleerd of het account gesynchroniseerd is,
# met on-premises Active Directory of alleen in de cloud bestaat.
foreach ($user in $users) {
    Write-Host "$($user.UserPrincipalName)`n==="
    if ($user.OnPremisesSyncEnabled) {
        Write-Host "Account Type: Synced`n"
        $syncedCount++
    }
    else {
        Write-Host "Account Type: Cloud"
        $cloudCount++
        if ($($user.UserType) -eq "Guest") {
            Write-Host "User Type: Guest`n"
            $guestCount++
        }
        else {
            Write-Host "User Type: Member`n"
            $memberCount++
        }
    }
}

Write-Host "=== Summary ==="
Write-Host "Cloud: $($cloudCount)`n   Guest: $($GuestCount)`n   Member: $($memberCount)`nSynced: $($syncedCount)"
Write-host "---`nGRAND TOTAL: $($users.count)"
    \end{minted}
    \caption[functie2.ps1]{Microsoft Graph PowerShell-script dat het aantal gebruikers binnen de omgeving onderverdeeld in interne en externe gebruikers.}
    \label{PSQ2}
\end{listing}

\subsection{Output}

\begin{tiny}
\begin{verbatim}
AdeleV@25ky3d.onmicrosoft.com
===
Account Type: Cloud
User Type: Member

Administrator@25ky3d.onmicrosoft.com
===
Account Type: Cloud
User Type: Member

AlexW@25ky3d.onmicrosoft.com
===
Account Type: Cloud
User Type: Member

DiegoS@25ky3d.onmicrosoft.com
===
Account Type: Cloud
User Type: Member

GradyA@25ky3d.onmicrosoft.com
===
Account Type: Cloud
User Type: Member

HenriettaM@25ky3d.onmicrosoft.com
===
Account Type: Cloud
User Type: Member

IsaiahL@25ky3d.onmicrosoft.com
===
Account Type: Cloud
User Type: Member

JohannaL@25ky3d.onmicrosoft.com
===
Account Type: Cloud
User Type: Member

JoniS@25ky3d.onmicrosoft.com
===
Account Type: Cloud
User Type: Member

LeeG@25ky3d.onmicrosoft.com
===
Account Type: Cloud
User Type: Member

LidiaH@25ky3d.onmicrosoft.com
===
Account Type: Cloud
User Type: Member

LynneR@25ky3d.onmicrosoft.com
===
Account Type: Cloud
User Type: Member

MeganB@25ky3d.onmicrosoft.com
===
Account Type: Cloud
User Type: Guest

MiriamG@25ky3d.onmicrosoft.com
===
Account Type: Cloud
User Type: Member

NestorW@25ky3d.onmicrosoft.com
===
Account Type: Cloud
User Type: Member

o_jcre@25ky3d.onmicrosoft.com
===
Account Type: Cloud
User Type: Member

PattiF@25ky3d.onmicrosoft.com
===
Account Type: Cloud
User Type: Member

PradeepG@25ky3d.onmicrosoft.com
===
Account Type: Cloud
User Type: Member

=== Summary ===
Cloud: 18
   Guest: 1
   Member: 17
Synced: 0
---
GRAND TOTAL: 18
\end{verbatim}
\end{tiny}

\clearpage

\section{Functie 3: Aantal gebruikers die geblokkeerd zijn}

\subsection{PowerShell-script: functie3.ps1}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=1.2mm,
        baselinestretch=1.2,
        fontsize=\tiny,
        linenos
        ]  
        {powershell}
# Haalt een lijst van alle gebruikers op die beschikbaar zijn in de Office 365-omgeving. 
# Het slaat de UserPrincipalName en AccountEnabled van elke gebruiker op in de variabele $users
$users = (Get-MgUser -Select UserPrincipalName,AccountEnabled)

# Initialiseert de variabelen $blockedUsers en $freeUsers als lege arrays.
$blockedUsers = $freeUsers = @()

# Doorloopt de lijst met gebruikers in $users.
# Het plaatst de gebruikers in de $blockedUsers array als hun AccountEnabled-waarde "false" is
# (wat betekent dat het account is geblokkeerd).
# Anders plaatst het de gebruikers in de $freeUsers array als hun AccountEnabled-waarde "true" is
# (wat betekent dat het account niet is geblokkeerd).
foreach ($user in $users) {
    if ($user.AccountEnabled -eq $false) { $blockedUsers += $user }
    else { $freeUsers += $user }
}

Write-Host "=== Account blocked? ==="

# Toont een samenvatting van het aantal geblokkeerde en actieve gebruikersaccounts,
# evenals de gebruikersnamen van elke geblokkeerde en actieve gebruiker.
Write-Host "TRUE: $($blockedUsers.count)"
foreach ($blockedUser in $blockedUsers) {
    Write-Host "   $($blockedUser.UserPrincipalName)"
}
Write-Host "FALSE: $($freeUsers.count)"
foreach ($freeUser in $freeUsers) {
    Write-Host "   $($freeUser.UserPrincipalName)"
}

Write-Host "---`nGRAND TOTAL: $($users.count)"
    \end{minted}
    \caption[functie3.ps1]{Microsoft Graph PowerShell-script dat het aantal gebruikers die geblokkeerd zijn weergeeft.}
    \label{PSQ3}
\end{listing}

\subsection{Output}

\begin{scriptsize}
\begin{verbatim}
=== Account blocked? ===
TRUE: 1
   LeeG@25ky3d.onmicrosoft.com
FALSE: 17
   AdeleV@25ky3d.onmicrosoft.com
   Administrator@25ky3d.onmicrosoft.com
   AlexW@25ky3d.onmicrosoft.com
   DiegoS@25ky3d.onmicrosoft.com
   GradyA@25ky3d.onmicrosoft.com
   HenriettaM@25ky3d.onmicrosoft.com
   IsaiahL@25ky3d.onmicrosoft.com
   JohannaL@25ky3d.onmicrosoft.com
   JoniS@25ky3d.onmicrosoft.com
   LidiaH@25ky3d.onmicrosoft.com
   LynneR@25ky3d.onmicrosoft.com
   MeganB@25ky3d.onmicrosoft.com
   MiriamG@25ky3d.onmicrosoft.com
   NestorW@25ky3d.onmicrosoft.com
   o_jcre@25ky3d.onmicrosoft.com
   PattiF@25ky3d.onmicrosoft.com
   PradeepG@25ky3d.onmicrosoft.com
---
GRAND TOTAL: 18
\end{verbatim}
\end{scriptsize}

\clearpage

\section{Functie 4: Aantal geblokkeerde gebruikers met actieve licenties}

\subsection{PowerShell-script: functie4.ps1}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=1.2mm,
        baselinestretch=1.2,
        fontsize=\tiny,
        linenos
        ]  
        {powershell}
# Haalt een lijst van alle gebruikers op die beschikbaar zijn in de Office 365-omgeving.
# Het slaat de UserPrincipalName en AccountEnabled van elke gebruiker op in de variabele $users.
$users = (Get-MgUser -Select UserPrincipalName,AccountEnabled)

# Initialiseert de variabelen $blockedUsers en $blockedUsersActiveLicenses als lege arrays.
$blockedUsersActiveLicenses = $blockedUsers = @()

# Doorloopt de lijst met gebruikers in $users.
# Het plaatst geblokkeerde gebruikers in de $blockedUsers array als hun AccountEnabled-waarde "false" is 
(wat betekent dat het account is geblokkeerd).
foreach ($user in $users) {
    if ($user.AccountEnabled -eq $false) { $blockedUsers += $user }
    else { $freeUsers += $user }
}

Write-Host "=== Blocked Users ==="

# Toont informatie over elke geblokkeerde gebruiker en controleert of ze al dan niet actieve licenties hebben.
foreach ($blockedUser in $blockedUsers) {
    if (Get-MgUserLicenseDetail -UserId $blockedUser.UserPrincipalName) { 
        Write-Host "$($blockedUser.UserPrincipalName) - Licenses: ACTIVE"
        $blockedUsersActiveLicenses += $blockedUser
    }
    else { Write-Host "$($blockedUser.UserPrincipalName) - Licenses: NOT ACTIVE" }
}

Write-Host "`nActive License Total: $($blockedUsersActiveLicenses.count)"
Write-Host "---`nGRAND TOTAL: $($blockedUsers.count)"
    \end{minted}
    \caption[functie4.ps1]{Microsoft Graph PowerShell-script dat het aantal geblokkeerde gebruikers met actieve licenties weergeeft.}
    \label{PSQ4}
\end{listing}

\subsection{Output}

\begin{scriptsize}
    \begin{verbatim}
=== Blocked Users ===
LeeG@25ky3d.onmicrosoft.com - Licenses: ACTIVE

Active Licenses Total: 1
---
GRAND TOTAL: 1
    \end{verbatim}
\end{scriptsize}

\clearpage

\section{Functie 5: Overzicht en telling van administrators met hun account status}

\subsection{PowerShell-script: functie5.ps1}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=1.2mm,
        baselinestretch=1.2,
        fontsize=\tiny,
        linenos
        ]  
        {powershell}
# Maakt een lege array aan voor de administrators
$adminUsers = @()

# Haalt de lijst van gebruikers op die de rol "Global Administrator" hebben
$admins = (Get-MgDirectoryRole -DirectoryRoleId "e26351ad-20e7-4446-8954-ed9411376217" -ExpandProperty "Members")

# Loopt door alle gebruikers in de "Global Administrator" rol
# Haalt de gebruiker op uit de lijst van gebruikers en voeg de gebruiker toe aan de array van administrateurs
foreach ($adminId in $admins.Members.Id) {
    $adminUsers += (Get-MgUser -UserId $adminId -Select UserPrincipalName,AccountEnabled)
}

# Loopt door de administrateurs en laat hun naam en status van hun account zien
Write-Host "=== Administrators ==="
foreach ($adminUser in $adminUsers) {
    Write-Host "$($adminUser.UserPrincipalName) - Account Enabled: $($adminUser.AccountEnabled)"
}

Write-Host "---`nGRAND TOTAL: $($adminUsers.count)"
    \end{minted}
    \caption[functie5.ps1]{Microsoft Graph PowerShell-script dat een overzicht weergeeft en een telling van de administrators met hun account status uitvoert.}
    \label{PSQ5}
\end{listing}

\subsection{Output}

\begin{scriptsize}
    \begin{verbatim}
=== Administrators ===
Administrator@25ky3d.onmicrosoft.com - Account Enabled: True
o_jcre@25ky3d.onmicrosoft.com - Account Enabled: True
---
GRAND TOTAL: 2
    \end{verbatim}
\end{scriptsize}

\clearpage

\section{Functie 6: Overzicht en telling van de interne gebruikers met MFA}

\subsection{PowerShell-script: functie6.ps1}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=1.1mm,
        baselinestretch=1.1,
        fontsize=\tiny,
        linenos
        ]  
        {powershell}
$results = $users = $MFAdisabled = $MFAenabled = @()
# Haalt alle gebruikers op uit de Microsoft 365-omgeving, selecteert alleen de properties UserPrincipalName en UserType.
$allUsers = (Get-MgUser -Select UserPrincipalName,UserType)
# Loopt door alle gebruikers en voeg alleen de leden toe aan de $users array
foreach ($member in $allUsers) { if ($member.UserType -eq "Member") { $users += $member } }
# Maakt een nieuw PSCustomObject met de gewenste properties en initialiseert ze als "-" of "_".
foreach ($user in $users) { $resultObject = [PSCustomObject]@{
        user               = "-"
        MFAstatus          = "_"
        email              = "-"
        fido2              = "-"
        app                = "-"
        password           = "-"
        phone              = "-"
        softwareoath       = "-"
        tempaccess         = "-"
        hellobusiness      = "-"
    }
    # Haalt de MFA-data op van de huidige gebruiker en slaat deze op in $MFAData.
    $MFAData = (Get-MgUserAuthenticationMethod -UserId $user.UserPrincipalName)
    $resultObject.user = $user.UserPrincipalName;
    # Loopt door alle methodes in $MFAData en stelt de bijbehorende properties in voor $resultObject.
    ForEach ($method in $MFAData) { Switch ($method.AdditionalProperties["@odata.type"]) {
            # Voor elke methode stelt het de overeenkomstige property in op $true en de MFA-status op "Enabled".
            "#microsoft.graph.emailAuthenticationMethod"  {
                $resultObject.email = $true
                $resultObject.MFAstatus = "Enabled"
            }
            "#microsoft.graph.fido2AuthenticationMethod"  {
                $resultObject.fido2 = $true
                $resultObject.MFAstatus = "Enabled"
            }
            "#microsoft.graph.microsoftAuthenticatorAuthenticationMethod"  {
                $resultObject.app = $true
                $resultObject.MFAstatus = "Enabled"
            }
            "#microsoft.graph.passwordAuthenticationMethod"  {
                $resultObject.password = $true
                # Wanneer alleen het wachtwoord is ingesteld, is MFA uitgeschakeld.
                if ($resultObject.MFAstatus -ne "Enabled") { $resultObject.MFAstatus = "Disabled" }
            }
            "#microsoft.graph.phoneAuthenticationMethod"  {
                $resultObject.phone = $true
                $resultObject.MFAstatus = "Enabled"
            }
            "#microsoft.graph.softwareOathAuthenticationMethod"  {
                $resultObject.softwareoath = $true
                $resultObject.MFAstatus = "Enabled"
            }
            "#microsoft.graph.temporaryAccessPassAuthenticationMethod"  {
                $resultObject.tempaccess = $true
                $resultObject.MFAstatus = "Enabled"
            }
            "#microsoft.graph.windowsHelloForBusinessAuthenticationMethod"  {
                $resultObject.hellobusiness = $true
                $resultObject.MFAstatus = "Enabled"
            }
        }
    } 
    $results += $resultObject;
}
# Loopt door $results en sorteert de resultaatobjecten op basis van hun MFA-status.
foreach ($result in $results) {
    if ($result.MFAstatus -eq "Disabled") { $MFAdisabled += $result } else { $MFAenabled += $result }
}
Write-Host "=== Summary ==="
Write-Host "MFA Disabled (Member): $($MFAdisabled.count) - $([math]::Round((($MFAdisabled.count/$results.count)*100),2))%"
Write-Host "MFA Enabled (Member): $($MFAenabled.count) - $([math]::Round((($MFAenabled.count/$results.count)*100),2))%"
Write-Host "---`nGRANT TOTAL: $($results.count) - 100%"
    \end{minted}
    \caption[functie6.ps1]{Microsoft Graph PowerShell-script met onderdelen uit het script van \textcite{Allen2023} dat een overzicht weergeeft en een telling van de interne gebruikers met \ac{MFA}.}
    \label{PSQ6}
\end{listing}

\clearpage

\subsection{Output}

\begin{scriptsize}
    \begin{verbatim}
=== Summary ===
MFA Disabled (Member): 14 - 82.35%
MFA Enabled (Member): 3 - 17.65%
---
GRAND TOTAL: 17 - 100%
PS D:\HoGent Documenten AJ 22-23\Bachelorproef\latex-hogent-bachproef> 
    \end{verbatim}
\end{scriptsize}

\clearpage 

\section{Functie 7: Aantal gelicenseerde, actieve accounts waarbij MFA niet aanwezig is}

\subsection{PowerShell-script: functie7.ps1}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=1.2mm,
        baselinestretch=1.2,
        fontsize=\tiny,
        linenos
        ]  
        {powershell}
$licensedUsers = $users = $results = $disabledMFAusers = @()
# Haalt alle gebruikers op in de Microsoft 365-omgeving, selecteert UserPrincipalName en AccountEnabled.
$allUsers = (Get-MgUser -Select UserPrincipalName,AccountEnabled)
# Doorloopt elke gebruiker in $allUsers, en controleert of de gebruiker een licentie heeft voor Microsoft 365.
foreach ($licensedUser in $allUsers) { 
    if (Get-MgUserLicenseDetail -UserId $licensedUser.UserPrincipalName) { $licensedUsers += $licensedUser } }
# Doorloopt elke gebruiker in $licensedUsers, en controleert of de AccountEnabled eigenschap 'True' is.
foreach ($enabledUser in $licensedUsers) { if ($enabledUser.AccountEnabled -eq $True) { $users += $enabledUser } }
# Maakt een nieuw PSCustomObject met de gewenste properties en initialiseert ze als "-" of "_".
foreach ($user in $users) { $resultObject = [PSCustomObject]@{
        user               = "-"
        MFAstatus          = "_"
        email              = "-"
        fido2              = "-"
        app                = "-"
        password           = "-"
        phone              = "-"
        softwareoath       = "-"
        tempaccess         = "-"
        hellobusiness      = "-" }
    # Haalt de MFA-data op van de huidige gebruiker en slaat deze op in $MFAData.
    $MFAData = (Get-MgUserAuthenticationMethod -UserId $user.UserPrincipalName)
    $resultObject.user = $user.UserPrincipalName;
    ForEach ($method in $MFAData) { Switch ($method.AdditionalProperties["@odata.type"]) {
            # Voor elke methode stelt het de overeenkomstige property in op $true en de MFA-status op "Enabled".
            "#microsoft.graph.emailAuthenticationMethod"  {
                $resultObject.email = $true
                $resultObject.MFAstatus = "Enabled"
            }
            "#microsoft.graph.fido2AuthenticationMethod"                   {
                $resultObject.fido2 = $true
                $resultObject.MFAstatus = "Enabled"
            }
            "#microsoft.graph.microsoftAuthenticatorAuthenticationMethod"  {
                $resultObject.app = $true
                $resultObject.MFAstatus = "Enabled"
            }
            "#microsoft.graph.passwordAuthenticationMethod"                {
                $resultObject.password = $true
                # Wanneer alleen het wachtwoord is ingesteld, is MFA uitgeschakeld.
                if ($resultObject.MFAstatus -ne "Enabled") { $resultObject.MFAstatus = "Disabled" }
            }
            "#microsoft.graph.phoneAuthenticationMethod"  {
                $resultObject.phone = $true
                $resultObject.MFAstatus = "Enabled"
            }
            "#microsoft.graph.softwareOathAuthenticationMethod"  {
                $resultObject.softwareoath = $true
                $resultObject.MFAstatus = "Enabled"
            }
            "#microsoft.graph.temporaryAccessPassAuthenticationMethod"  {
                $resultObject.tempaccess = $true
                $resultObject.MFAstatus = "Enabled"
            }
            "#microsoft.graph.windowsHelloForBusinessAuthenticationMethod"  {
                $resultObject.hellobusiness = $true
                $resultObject.MFAstatus = "Enabled"
        } }
    } $results += $resultObject;
}
# loopt door elk object in de $results array en controleert of MFAstatus gelijk is aan "Disabled".
foreach ($disabledMFA in $results) { if ($disabledMFA.MFAstatus -eq "Disabled") { $disabledMFAusers += $disabledMFA } }
$disabledMFAusers
Write-Host "=== Summary ===`nMFA Disabled (Licensed + Account Enabled): $($disabledMFAusers.count)"
    \end{minted}
    \caption[functie7.ps1]{Microsoft Graph PowerShell-script met onderdelen uit het script van \textcite{Allen2023} dat het aantal gelicenseerde, actieve accounts waarbij \Ac{MFA} niet aanwezig is weergeeft.}
    \label{PSQ7}
\end{listing}

\clearpage

\subsection{Output}

\begin{tiny}
    \begin{verbatim}
user          : AlexW@25ky3d.onmicrosoft.com
MFAstatus     : Disabled
email         : -
fido2         : -
app           : -
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

user          : DiegoS@25ky3d.onmicrosoft.com
MFAstatus     : Disabled
email         : -
fido2         : -
app           : -
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

user          : GradyA@25ky3d.onmicrosoft.com
MFAstatus     : Disabled
email         : -
fido2         : -
app           : -
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

user          : HenriettaM@25ky3d.onmicrosoft.com
MFAstatus     : Disabled
email         : -
fido2         : -
app           : -
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

user          : IsaiahL@25ky3d.onmicrosoft.com
MFAstatus     : Disabled
email         : -
fido2         : -
app           : -
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

user          : JohannaL@25ky3d.onmicrosoft.com
MFAstatus     : Disabled
email         : -
fido2         : -
app           : -
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

user          : JoniS@25ky3d.onmicrosoft.com
MFAstatus     : Disabled
email         : -
fido2         : -
app           : -
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

user          : LidiaH@25ky3d.onmicrosoft.com
MFAstatus     : Disabled
email         : -
fido2         : -
app           : -
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

user          : LynneR@25ky3d.onmicrosoft.com
MFAstatus     : Disabled
email         : -
fido2         : -
app           : -
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

user          : MeganB@25ky3d.onmicrosoft.com
MFAstatus     : Disabled
email         : -
fido2         : -
app           : -
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

user          : MiriamG@25ky3d.onmicrosoft.com
MFAstatus     : Disabled
email         : -
fido2         : -
app           : -
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

user          : NestorW@25ky3d.onmicrosoft.com
MFAstatus     : Disabled
email         : -
fido2         : -
app           : -
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

user          : PattiF@25ky3d.onmicrosoft.com
MFAstatus     : Disabled
email         : -
fido2         : -
app           : -
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

user          : PradeepG@25ky3d.onmicrosoft.com
MFAstatus     : Disabled
email         : -
fido2         : -
app           : -
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

=== Summary ===
MFA Disabled (Licensed + Account Enabled): 14
    \end{verbatim}
\end{tiny}

\clearpage

\section{Functie 8: Aantal externe accounts waarbij MFA uitstaat}

\subsection{PowerShell-script: functie8.ps1}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=1.2mm,
        baselinestretch=1.2,
        fontsize=\tiny,
        linenos
        ]  
        {powershell}
$results = $users = @()
# Haalt alle gebruikers op en selecteert hun UserPrincipalName en UserType.
$allUsers = (Get-MgUser -Select UserPrincipalName,UserType)
# Loopt door elke gebruiker en voeg ze toe aan de $users array als ze een "Guest" zijn
foreach ($member in $allUsers) { if ($member.UserType -eq "Guest") { $users += $member } }
# Maakt een nieuw PSCustomObject met de gewenste properties en initialiseert ze als "-" of "_".
foreach ($user in $users) { $resultObject = [PSCustomObject]@{
        user               = "-"
        MFAstatus          = "_"
        email              = "-"
        fido2              = "-"
        app                = "-"
        password           = "-"
        phone              = "-"
        softwareoath       = "-"
        tempaccess         = "-"
        hellobusiness      = "-"
    }
    # Haalt de MFA-data op van de huidige gebruiker en slaat deze op in $MFAData.
    $MFAData = (Get-MgUserAuthenticationMethod -UserId $user.UserPrincipalName)
    $resultObject.user = $user.UserPrincipalName;
    ForEach ($method in $MFAData) { Switch ($method.AdditionalProperties["@odata.type"]) {
            # Voor elke methode stelt het de overeenkomstige property in op $true en de MFA-status op "Enabled".
            "#microsoft.graph.emailAuthenticationMethod"  {
                $resultObject.email = $true
                $resultObject.MFAstatus = "Enabled"
            }
            "#microsoft.graph.fido2AuthenticationMethod"                   {
                $resultObject.fido2 = $true
                $resultObject.MFAstatus = "Enabled"
            }
            "#microsoft.graph.microsoftAuthenticatorAuthenticationMethod"  {
                $resultObject.app = $true
                $resultObject.MFAstatus = "Enabled"
            }
            "#microsoft.graph.passwordAuthenticationMethod"                {
                $resultObject.password = $true
                # Wanneer alleen het wachtwoord is ingesteld, is MFA uitgeschakeld.
                if($resultObject.MFAstatus -ne "Enabled") { $resultObject.MFAstatus = "Disabled" }
            }
            "#microsoft.graph.phoneAuthenticationMethod"  {
                $resultObject.phone = $true
                $resultObject.MFAstatus = "Enabled"
            }
            "#microsoft.graph.softwareOathAuthenticationMethod"  {
                $resultObject.softwareoath = $true
                $resultObject.MFAstatus = "Enabled"
            }
            "#microsoft.graph.temporaryAccessPassAuthenticationMethod"  {
                $resultObject.tempaccess = $true
                $resultObject.MFAstatus = "Enabled"
            }
            "#microsoft.graph.windowsHelloForBusinessAuthenticationMethod"  {
                $resultObject.hellobusiness = $true
                $resultObject.MFAstatus = "Enabled"
            }
        }
    } $results += $resultObject;
}
# Toont de resultaten van het object.
$results
Write-Host "=== Summary ===`nMFA Disabled (Guest): $($results.count)"
    \end{minted}
    \caption[functie8.ps1]{Microsoft Graph PowerShell-script met onderdelen uit het script van \textcite{Allen2023} dat het aantal externe accounts waarbij \Ac{MFA} uitstaat weergeeft.}
    \label{PSQ8}
\end{listing}

\subsection{Output}

\begin{scriptsize}
    \begin{verbatim}
user          : MeganB@25ky3d.onmicrosoft.com
MFAstatus     : Disabled
email         : -
fido2         : -
app           : -
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

=== Summary ===
MFA Disabled (Guest): 1
    \end{verbatim}
\end{scriptsize}

\clearpage

\section{Functie 9: Overzicht van accounts met administrator-priviliges, onderverdeeld in gebruik van MFA}

\subsection{PowerShell-script: functie9.ps1}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=1.2mm,
        baselinestretch=1.2,
        fontsize=\tiny,
        linenos
        ]  
        {powershell}
$users = $results = $MFAenabled = $MFAdisabled = @()
# Haal de leden van de beheerdersrol op en sla deze op in $admins
$admins = (Get-MgDirectoryRole -DirectoryRoleId "e26351ad-20e7-4446-8954-ed9411376217" -ExpandProperty "Members")
foreach ($adminId in $admins.Members.Id) { $users += (Get-MgUser -Select UserPrincipalName,UserType -UserId $adminId) }
# Maakt een nieuw PSCustomObject met de gewenste properties en initialiseert ze als "-" of "_".
foreach ($user in $users) { $resultObject = [PSCustomObject]@{
        user               = "-"
        MFAstatus          = "_"
        email              = "-"
        fido2              = "-"
        app                = "-"
        password           = "-"
        phone              = "-"
        softwareoath       = "-"
        tempaccess         = "-"
        hellobusiness      = "-"
    }
    # Haalt de MFA-data op van de huidige gebruiker en slaat deze op in $MFAData.
    $MFAData = (Get-MgUserAuthenticationMethod -UserId $user.UserPrincipalName)
    $resultObject.user = $user.UserPrincipalName;
    ForEach ($method in $MFAData) { Switch ($method.AdditionalProperties["@odata.type"]) {
            # Voor elke methode stelt het de overeenkomstige property in op $true en de MFA-status op "Enabled".
            "#microsoft.graph.emailAuthenticationMethod"  {
                $resultObject.email = $true
                $resultObject.MFAstatus = "Enabled" }
            "#microsoft.graph.fido2AuthenticationMethod"                   {
                $resultObject.fido2 = $true
                $resultObject.MFAstatus = "Enabled" }
            "#microsoft.graph.microsoftAuthenticatorAuthenticationMethod"  {
                $resultObject.app = $true
                $resultObject.MFAstatus = "Enabled" }
            "#microsoft.graph.passwordAuthenticationMethod"                {
                $resultObject.password = $true
                # Wanneer alleen het wachtwoord is ingesteld, is MFA uitgeschakeld.
                if($resultObject.MFAstatus -ne "Enabled") { $resultObject.MFAstatus = "Disabled" }
            }
            "#microsoft.graph.phoneAuthenticationMethod"  {
                $resultObject.phone = $true
                $resultObject.MFAstatus = "Enabled" }
            "#microsoft.graph.softwareOathAuthenticationMethod"  {
                $resultObject.softwareoath = $true
                $resultObject.MFAstatus = "Enabled" }
            "#microsoft.graph.temporaryAccessPassAuthenticationMethod"  {
                $resultObject.tempaccess = $true
                $resultObject.MFAstatus = "Enabled" }
            "#microsoft.graph.windowsHelloForBusinessAuthenticationMethod"  {
                $resultObject.hellobusiness = $true
                $resultObject.MFAstatus = "Enabled" }
        }
    } $results += $resultObject;
} 
$results # Toont de resultaten van het object.
Write-Host "=== Summary ==="
foreach ($result in $results) {
    if ($result.MFAstatus -eq "Enabled") { $MFAenabled += $result}
    else { $MFAdisabled += $result} }
Write-Host "MFA Enabled: $($MFAenabled.count)"
foreach ($MFAenabledUser in $MFAenabled) { Write-Host "   $($MFAenabledUser.user)" }
Write-Host "MFA Disabled: $($MFAdisabled.count)"
foreach ($MFAdisabledUser in $MFAdisabled) { Write-Host "   $($MFAdisabledUser.user)" }
Write-Host "---`nGRAND TOTAL: $($results.count)"
    \end{minted}
    \caption[functie9.ps1]{Microsoft Graph PowerShell-script met onderdelen uit het script van \textcite{Allen2023} dat een overzicht geeft van de accounts met administrator-priviliges, onderverdeeld in gebruik van \Ac{MFA}.}
    \label{PSQ9}
\end{listing}

\subsection{Output}

\begin{scriptsize}
    \begin{verbatim}
user          : Administrator@25ky3d.onmicrosoft.com
MFAstatus     : Enabled
email         : -
fido2         : -
app           : True
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

user          : o_jcre@25ky3d.onmicrosoft.com
MFAstatus     : Enabled
email         : -
fido2         : -
app           : True
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

=== Summary ===
MFA Enabled: 2
   Administrator@25ky3d.onmicrosoft.com
   o_jcre@25ky3d.onmicrosoft.com
MFA Disabled: 0
---
GRAND TOTAL: 2
    \end{verbatim}
\end{scriptsize}
\clearpage
\section{Functie 14: Onderverdeling van hoeveelheid mailboxen per domein}

\subsection{PowerShell-script: functie14.ps1}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=1.2mm,
        baselinestretch=1.2,
        fontsize=\tiny,
        linenos
        ]  
        {powershell}
$mailboxes = @()

# De $users variabele wordt gevuld met gebruikersdata.
$users = (Get-MgUser -Select "Mail")

# De $domains variabele wordt gevuld met domeinen.
$domains = (Get-MgDomain -Select "Id")

# Loopt door elk domein in $domains.
foreach ($domain in $domains) {
    # Maakt een regex-patroon dat overeenkomt met het huidige domein.
    $domainRegex = [regex]::Escape($domain.Id)
    # Loopt door elk gebruikersobject in $users
    foreach ($user in $users) {
        # Controleert of het e-mailadres van de huidige gebruiker overeenkomt met het regex-patroon.
        if ($user.Mail -match "$domainRegex") {
            $mailboxes += $user.Mail
        }
    }
}
Write-Host "=== Summary ==="
# Loopt door elk domein in $domains en elk e-mailadres in de $mailboxes array
foreach ($domain in $domains) {
    Write-Host "Domain: $($domain.id)"
    foreach ($mailbox in $mailboxes) {
        Write-Host "   $($mailbox)"
    }
    Write-Host "   ---`n   Mailboxes: $($mailboxes.count)"
}
    \end{minted}
    \caption[functie14.ps1]{Microsoft Graph PowerShell-script dat een onderverdeling weergeeft van de hoeveelheid mailboxen per domein.}
    \label{PSQ14}
\end{listing}
\subsection{Output}
\begin{scriptsize}
    \begin{verbatim}
=== Summary ===
Domain: 25ky3d.onmicrosoft.com
   AdeleV@25ky3d.onmicrosoft.com
   Administrator@25ky3d.onmicrosoft.com
   AlexW@25ky3d.onmicrosoft.com
   DiegoS@25ky3d.onmicrosoft.com
   GradyA@25ky3d.onmicrosoft.com
   HenriettaM@25ky3d.onmicrosoft.com
   IsaiahL@25ky3d.onmicrosoft.com
   JohannaL@25ky3d.onmicrosoft.com
   JoniS@25ky3d.onmicrosoft.com
   LeeG@25ky3d.onmicrosoft.com
   LidiaH@25ky3d.onmicrosoft.com
   LynneR@25ky3d.onmicrosoft.com
   MeganB@25ky3d.onmicrosoft.com
   MiriamG@25ky3d.onmicrosoft.com
   NestorW@25ky3d.onmicrosoft.com
   PattiF@25ky3d.onmicrosoft.com
   PradeepG@25ky3d.onmicrosoft.com
   ---
   Mailboxes: 17
    \end{verbatim}
\end{scriptsize}

\section{Functie 15: Overzicht van accounts met als primair SMTP-adresdomein “.onmicrosoft.com”}
\subsection{PowerShell-script: functie15.ps1}
\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=1.2mm,
        baselinestretch=1.2,
        fontsize=\tiny,
        linenos
        ]  
        {powershell}
# Haalt de UPN en de e-mailadressen van alle gebruikers op en sla ze op in de variabele $users
$users = (Get-MgUser -Select UserPrincipalName, Mail)   

# Initialiseert de tellers $SMTPgroup1Count en $SMTPotherCount
$SMTPgroup1Count = $SMTPotherCount = 0   

# Definieert de regex die overeenkomt met het gewenste e-maildomein
$SMTPmatch1 = "\.onmicrosoft\.com$" 

# Initialiseer lege arrays voor de twee SMTP-categorieën
$SMTPgroup1 = $SMTPothers = @()   

# Loopt door de lijst van gebruikers en er wordt gecontroleerd of de “Mail” eindigt op ".onmicrosoft.com". 
# Indien ja, voeg de gebruiker toe aan de $SMTPgroup1 array. 
# Indien nee, voeg de gebruiker toe aan de $SMTPothers array.
foreach ($user in $users) {
    if (($user.Mail) -match $SMTPmatch1) {  
        $SMTPgroup1 += $user   
        $SMTPgroup1Count++ 
    }
    else {
        $SMTPothers += $user   
        $SMTPotherCount++   
    }
}
Write-Host "=== Summary ==="

# Toont de gebruikers die behoren tot SMTPgroup1
Write-Host "SMTP: .onmicrosoft.com"
foreach ($SMTPgroup1User in $SMTPgroup1) {   
    Write-Host "   UPN: $($SMTPgroup1User.UserPrincipalName) - MAIL: $($SMTPgroup1User.Mail)"
}
Write-Host "   ---`n   TOTAL: $($SMTPgroup1.count)`n"

# Toont de gebruikers die behoren tot SMTPothers
Write-Host "SMTP: Others"
foreach ($SMTPotherUser in $SMTPothers) {   
    if ($SMTPotherUser.Mail) { Write-Host "   UPN: $($SMTPotherUser.UserPrincipalName) - MAIL: $($SMTPotherUser.Mail)" }
    else { Write-Host "   UPN: $($SMTPotherUser.UserPrincipalName) - MAIL: Not available"}
}
Write-Host "   ---`n   TOTAL: $($SMTPothers.count)"

Write-host "---`nGRAND TOTAL: $($users.count)"
    \end{minted}
    \caption[functie15.ps1]{Microsoft Graph PowerShell-script dat een overzicht geeft van accounts met als primair \ac{SMTP}-adresdomein “.onmicrosoft.com”}
    \label{PSQ15}
\end{listing}

\clearpage

\subsection{Output}

\begin{scriptsize}
    \begin{verbatim}
=== Summary ===
SMTP: .onmicrosoft.com
   UPN: AdeleV@25ky3d.onmicrosoft.com - MAIL: AdeleV@25ky3d.onmicrosoft.com
   UPN: Administrator@25ky3d.onmicrosoft.com - MAIL: Administrator@25ky3d.onmicrosoft.com
   UPN: AlexW@25ky3d.onmicrosoft.com - MAIL: AlexW@25ky3d.onmicrosoft.com
   UPN: DiegoS@25ky3d.onmicrosoft.com - MAIL: DiegoS@25ky3d.onmicrosoft.com
   UPN: GradyA@25ky3d.onmicrosoft.com - MAIL: GradyA@25ky3d.onmicrosoft.com
   UPN: HenriettaM@25ky3d.onmicrosoft.com - MAIL: HenriettaM@25ky3d.onmicrosoft.com
   UPN: IsaiahL@25ky3d.onmicrosoft.com - MAIL: IsaiahL@25ky3d.onmicrosoft.com
   UPN: JohannaL@25ky3d.onmicrosoft.com - MAIL: JohannaL@25ky3d.onmicrosoft.com
   UPN: JoniS@25ky3d.onmicrosoft.com - MAIL: JoniS@25ky3d.onmicrosoft.com
   UPN: LeeG@25ky3d.onmicrosoft.com - MAIL: LeeG@25ky3d.onmicrosoft.com
   UPN: LidiaH@25ky3d.onmicrosoft.com - MAIL: LidiaH@25ky3d.onmicrosoft.com
   UPN: LynneR@25ky3d.onmicrosoft.com - MAIL: LynneR@25ky3d.onmicrosoft.com
   UPN: MeganB@25ky3d.onmicrosoft.com - MAIL: MeganB@25ky3d.onmicrosoft.com
   UPN: MiriamG@25ky3d.onmicrosoft.com - MAIL: MiriamG@25ky3d.onmicrosoft.com
   UPN: NestorW@25ky3d.onmicrosoft.com - MAIL: NestorW@25ky3d.onmicrosoft.com
   UPN: PattiF@25ky3d.onmicrosoft.com - MAIL: PattiF@25ky3d.onmicrosoft.com
   UPN: PradeepG@25ky3d.onmicrosoft.com - MAIL: PradeepG@25ky3d.onmicrosoft.com
   ---
   TOTAL: 17

SMTP: Others
   UPN: o_jcre@25ky3d.onmicrosoft.com - MAIL: Not available
   ---
   TOTAL: 1
---
GRAND TOTAL: 18
    \end{verbatim}
\end{scriptsize}

\clearpage

\section{Functie 19: Overzicht verschillende types van licenties en het aantal personen met dit licentietype}

\subsection{PowerShell-script: functie19.ps1}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=1.2mm,
        baselinestretch=1.2,
        fontsize=\tiny,
        linenos
        ]  
        {powershell}
$upnArray = @()
$licenseCounts = @{}

# Haalt alle gebruikers op en doorloopt de gebruikers één voor één.
# Voegt de User Principal Name toe aan de array.
Get-MgUser | ForEach-Object {
    $upnArray += $_.UserPrincipalName
}

# Doorloopt elke gebruiker uit de array en haalt de licentiedetails op.
# Het slaat dit op in $cmd, $servicePlans slaat de service plans op uit $cmd.
# De service plannen worden opgeteld in een lijst aan de hand van een hash-tabel.
# De tabel houdt het aantal licenties per gebruiker bij en sorteert dit alfabetisch. 
foreach ($upn in $upnArray) {
    $cmd = (Get-MgUserLicenseDetail -UserID $upn)
    $servicePlans = $cmd.ServicePlans
    foreach ($license in $servicePlans.ServicePlanName) {
        if ($licenseCounts.ContainsKey($license)) {
            $licenseCounts[$license]++
        } 
        else {
            $licenseCounts[$license] = 1
        }
    }
}

Write-Host "=== Summary ==="
foreach ($licenseName in $licenseCounts.Keys | Sort-Object) {
    Write-Host "$($licenseName): $($licenseCounts[$licenseName])"
}
    \end{minted}
    \caption[functie19.ps1]{Microsoft Graph PowerShell-script dat een overzicht geeft van de verschillende types van licenties en het aantal personen weergeeft met dit licentietype.}
    \label{PSQ19}
\end{listing}

\clearpage

\subsection{Output}

\begin{tiny}
    \begin{verbatim}
=== Summary ===
AAD_PREMIUM: 17
AAD_PREMIUM_P2: 17
ADALLOM_S_O365: 17
ADALLOM_S_STANDALONE: 17
ATA: 17
ATP_ENTERPRISE: 17
BI_AZURE_P2: 17
BPOS_S_TODO_3: 17
CDS_O365_P3: 17
COMMUNICATIONS_COMPLIANCE: 17
COMMUNICATIONS_DLP: 17
Content_Explorer: 17
CUSTOMER_KEY: 17
DATA_INVESTIGATIONS: 17
Deskless: 17
DYN365_CDS_O365_P3: 17
EQUIVIO_ANALYTICS: 17
EXCEL_PREMIUM: 17
EXCHANGE_ANALYTICS: 17
EXCHANGE_S_ENTERPRISE: 17
FLOW_O365_P3: 17
FORMS_PLAN_E5: 17
GRAPH_CONNECTORS_SEARCH_INDEX: 17
INFO_GOVERNANCE: 17
INSIDER_RISK: 17
INSIDER_RISK_MANAGEMENT: 17
INTUNE_A: 17
INTUNE_O365: 17
LOCKBOX_ENTERPRISE: 17
M365_ADVANCED_AUDITING: 17
MCOEV: 17
MCOSTANDARD: 17
MFA_PREMIUM: 17
MICROSOFT_COMMUNICATION_COMPLIANCE: 17
MICROSOFT_SEARCH: 17
MICROSOFTBOOKINGS: 17
MIP_S_CLP1: 17
MIP_S_CLP2: 17
MIP_S_Exchange: 17
ML_CLASSIFICATION: 17
MTP: 17
Nucleus: 17
OFFICESUBSCRIPTION: 17
PAM_ENTERPRISE: 17
POWER_VIRTUAL_AGENTS_O365_P3: 17
POWERAPPS_O365_P3: 17
PROJECT_O365_P3: 17
PROJECTWORKMANAGEMENT: 17
RECORDS_MANAGEMENT: 17
RMS_S_ENTERPRISE: 17
RMS_S_PREMIUM: 17
RMS_S_PREMIUM2: 17
SAFEDOCS: 17
SHAREPOINTENTERPRISE: 17
SHAREPOINTWAC: 17
STREAM_O365_E5: 17
SWAY: 17
TEAMS1: 17
THREAT_INTELLIGENCE: 17
VIVA_LEARNING_SEEDED: 17
WHITEBOARD_PLAN3: 17
YAMMER_ENTERPRISE: 17
    \end{verbatim}
\end{tiny}

\clearpage

\section{Functie 20: Overzicht van de MFA-methodes met het aantal gebruikers}

\subsection{PowerShell-script: functie20.ps1}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=1.1mm,
        baselinestretch=1.1,
        fontsize=\tiny,
        linenos
        ]  
        {powershell}
$results=@()
$users = (Get-MgUser -All)
$emailCount = $fido2Count = $appCount = $passwordCount = $phoneCount = 0
$softwareoathCount = $tempaccessCount = $hellobusinessCount = 0
# Maakt een nieuw PSCustomObject met de gewenste properties en initialiseert ze als "-" of "_".
foreach ($user in $users) { $resultObject = [PSCustomObject]@{
        user               = "-"
        MFAstatus          = "_"
        email              = "-"
        fido2              = "-"
        app                = "-"
        password           = "-"
        phone              = "-"
        softwareoath       = "-"
        tempaccess         = "-"
        hellobusiness      = "-"
    }
    # Haalt de MFA-data op van de huidige gebruiker en slaat deze op in $MFAData.
    $MFAData = (Get-MgUserAuthenticationMethod -UserId $user.UserPrincipalName)
    $resultObject.user = $user.UserPrincipalName;
    # Loopt door alle methodes in $MFAData en stelt de bijbehorende properties in voor $resultObject.
    ForEach ($method in $MFAData) { Switch ($method.AdditionalProperties["@odata.type"]) {
            # Voor elke methode stelt het de overeenkomstige property in op $true en de MFA-status op "Enabled".      
            "#microsoft.graph.emailAuthenticationMethod"  {
                $resultObject.email = $true
                $resultObject.MFAstatus = "Enabled" }
            "#microsoft.graph.fido2AuthenticationMethod"                   {
                $resultObject.fido2 = $true
                $resultObject.MFAstatus = "Enabled" }
            "#microsoft.graph.microsoftAuthenticatorAuthenticationMethod"  {
                $resultObject.app = $true
                $resultObject.MFAstatus = "Enabled" }
            "#microsoft.graph.passwordAuthenticationMethod"                {
                $resultObject.password = $true
                # Wanneer alleen het wachtwoord is ingesteld, is MFA uitgeschakeld.
                if($resultObject.MFAstatus -ne "Enabled") { $resultObject.MFAstatus = "Disabled" } }
            "#microsoft.graph.phoneAuthenticationMethod"  {
                $resultObject.phone = $true
                $resultObject.MFAstatus = "Enabled" }
            "#microsoft.graph.softwareOathAuthenticationMethod"  {
                $resultObject.softwareoath = $true
                $resultObject.MFAstatus = "Enabled" }
            "#microsoft.graph.temporaryAccessPassAuthenticationMethod"  {
                $resultObject.tempaccess = $true
                $resultObject.MFAstatus = "Enabled" }
            "#microsoft.graph.windowsHelloForBusinessAuthenticationMethod"  {
                $resultObject.hellobusiness = $true
                $resultObject.MFAstatus = "Enabled" }
        }
    } $results += $resultObject;
}
# Doorloopt de lijst van gebruikers en telt het aantal gebruikers voor elk type MFA-methode die is ingeschakeld.
ForEach ($MFAusers in $results) { ForEach ($MFAuser in $MFAusers) {
        if ($MFAuser.email -eq "True") { $emailCount++ }
        if ($MFAuser.fido2 -eq "True") { $fido2Count++ }
        if ($MFAuser.app -eq "True") { $appCount++ }
        if ($MFAuser.password -eq "True") { $passwordCount++ }
        if ($MFAuser.phone -eq "True") { $phoneCount++ }
        if ($MFAuser.softwareoath -eq "True") { $softwareoathCount++ }
        if ($MFAuser.tempaccess -eq "True") { $tempaccessCount++ }
        if ($MFAuser.hellobusiness -eq "True") { $hellobusinessCount++ }
} } $results
Write-Host "=== Summary ==="
Write-Host "Email: $($emailCount)`nFIDO2: $($fido2Count)`nApp: $($appCount)"
Write-Host "Password: $($passwordCount)`nPhone: $($phoneCount)`nSoftware OATH: $($softwareoathCount)"
Write-Host "Temporary Access: $($tempaccessCount)`nHello for Business: $($hellobusinessCount)"
    \end{minted}
    \caption[functie20.ps1]{Microsoft Graph PowerShell-script met onderdelen uit het script van \textcite{Allen2023} dat een overzicht geeft van de \Ac{MFA}-methodes met het aantal gebruikers.}
    \label{PSQ20}
\end{listing}

\subsection{Output}

\begin{tiny}
    \begin{verbatim}
user          : AdeleV@25ky3d.onmicrosoft.com
MFAstatus     : Enabled
email         : -
fido2         : -
app           : True
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

user          : Administrator@25ky3d.onmicrosoft.com
MFAstatus     : Enabled
email         : -
fido2         : -
app           : True
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

user          : AlexW@25ky3d.onmicrosoft.com
MFAstatus     : Disabled
email         : -
fido2         : -
app           : -
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

user          : DiegoS@25ky3d.onmicrosoft.com
MFAstatus     : Disabled
email         : -
fido2         : -
app           : -
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

user          : GradyA@25ky3d.onmicrosoft.com
MFAstatus     : Disabled
email         : -
fido2         : -
app           : -
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

user          : HenriettaM@25ky3d.onmicrosoft.com
MFAstatus     : Disabled
email         : -
fido2         : -
app           : -
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

user          : IsaiahL@25ky3d.onmicrosoft.com
MFAstatus     : Disabled
email         : -
fido2         : -
app           : -
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

user          : JohannaL@25ky3d.onmicrosoft.com
MFAstatus     : Disabled
email         : -
fido2         : -
app           : -
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

user          : JoniS@25ky3d.onmicrosoft.com
MFAstatus     : Disabled
email         : -
fido2         : -
app           : -
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

user          : LeeG@25ky3d.onmicrosoft.com
MFAstatus     : Disabled
email         : -
fido2         : -
app           : -
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

user          : LidiaH@25ky3d.onmicrosoft.com
MFAstatus     : Disabled
email         : -
fido2         : -
app           : -
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

user          : LynneR@25ky3d.onmicrosoft.com
MFAstatus     : Disabled
email         : -
fido2         : -
app           : -
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

user          : MeganB@25ky3d.onmicrosoft.com
MFAstatus     : Disabled
email         : -
fido2         : -
app           : -
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

user          : MiriamG@25ky3d.onmicrosoft.com
MFAstatus     : Disabled
email         : -
fido2         : -
app           : -
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

user          : NestorW@25ky3d.onmicrosoft.com
MFAstatus     : Disabled
email         : -
fido2         : -
app           : -
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

user          : o_jcre@25ky3d.onmicrosoft.com
MFAstatus     : Enabled
email         : -
fido2         : -
app           : True
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

user          : PattiF@25ky3d.onmicrosoft.com
MFAstatus     : Disabled
email         : -
fido2         : -
app           : -
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

user          : PradeepG@25ky3d.onmicrosoft.com
MFAstatus     : Disabled
email         : -
fido2         : -
app           : -
password      : True
phone         : -
softwareoath  : -
tempaccess    : -
hellobusiness : -

=== Summary ===
Email: 0
FIDO2: 0
App: 3
Password: 18
Phone: 0
Software OATH: 0
Temporary Access: 0
Hello for Business: 0
    \end{verbatim}
\end{tiny}