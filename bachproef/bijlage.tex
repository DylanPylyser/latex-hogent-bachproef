\chapter{Request- en Response-queries}%
\label{ch:HTTP-queries}

\clearpage

\section{Query 1: Opvragen domeinen}

\subsection{Azure AD Graph}

\subsubsection{Request}

\begin{itemize}
    \item \Ac{HTTP}-method: GET
    \item \ac{URL}: https://graph.windows.net/ffa43659-...-838af35d1353/domains
    \item \Ac{API}-version: 1.6
\end{itemize}

\subsubsection{Response body}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=2mm,
        baselinestretch=1.2,
        fontsize=\scriptsize,
        linenos
        ]  
        {json}
{
    "odata.metadata": "https://graph.windows.net/ffa43659-...-838af35d1353/$metadata#domains",
    "value": [
    {
        "authenticationType": "Managed",
        "availabilityStatus": null,
        "isAdminManaged": true,
        "isDefault": true,
        "isDefaultForCloudRedirections": false,
        "isInitial": true,
        "isRoot": true,
        "isVerified": true,
        "name": "25ky3d.onmicrosoft.com",
        "supportedServices": ["Email", "OfficeCommunicationsOnline"],
        "forceDeleteState": null,
        "state": null,
        "passwordValidityPeriodInDays": 2147483647,
        "passwordNotificationWindowInDays": 14
    }
    ]
}
    \end{minted}
    \caption[Query 1: Response body Azure AD Graph]{Response body van de eerste query via Azure \ac{AD} Graph Explorer.}
    \label{Q1AADRB}
\end{listing}

%\clearpage

\subsubsection{Response header}

\begin{listing}[ht]
    \begin{minted}
        [
        frame=lines,
        framesep=2mm,
        baselinestretch=1.2,
        fontsize=\scriptsize,
        linenos
        ]  
        {json}
{
    "cache-control": "no-cache",
    "client-request-id": "82bc7ed4-db42-414f-8260-73754bca7ce1",
    "content-length": "504",
    "content-type": "application/json; odata=minimalmetadata; streaming=true; charset=utf-8",
    "expires": "-1",
    "ocp-aad-session-key": "fdBtvCAl-..._n1UQvQe9reWesQHDTlUo",
    "pragma": "no-cache",
    "request-id": "dfd33cc1-ca0e-4964-ae48-0d3f6f222514"
}
    \end{minted}
    \caption[Query 1: Response header Azure AD Graph]{Response header van de eerste query via Azure \ac{AD} Graph Explorer.}
    \label{Q1AADRH}
\end{listing}

\subsection{Microsoft Graph}

\subsubsection{Request}

\begin{itemize}
    \item \Ac{HTTP}-method: GET
    \item \Ac{API}-version: 1.0
    \item \ac{URL}: https://graph.microsoft.com/v1.0/domains
\end{itemize}

\subsubsection{Response body}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=2mm,
        baselinestretch=1.2,
        fontsize=\scriptsize,
        linenos
        ]  
        {json}
{
    "@odata.context": "https://graph.microsoft.com/v1.0/$metadata#domains",
    "value": [
    {
        "authenticationType": "Managed",
        "availabilityStatus": null,
        "id": "25ky3d.onmicrosoft.com",
        "isAdminManaged": true,
        "isDefault": true,
        "isInitial": true,
        "isRoot": true,
        "isVerified": true,
        "supportedServices": ["Email", "OfficeCommunicationsOnline"],
        "passwordValidityPeriodInDays": 2147483647,
        "passwordNotificationWindowInDays": 14,
        "state": null
    }
    ]
}
    \end{minted}
    \caption[Query 1: Response body Microsoft Graph]{Response body van de eerste query via Microsoft Graph Explorer.}
    \label{Q1MSGRB}
\end{listing}

\subsubsection{Response header}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=2mm,
        baselinestretch=1.2,
        fontsize=\scriptsize,
        linenos
        ]  
        {json}
{
    "cache-control": "no-cache",
    "client-request-id": "45bd0201-69d2-f78c-cee8-aaedfce8b3d8",
    "content-type": "application/json;odata.metadata=minimal;odata.streaming=true;
        IEEE754Compatible=false;charset=utf-8",
    "request-id": "0f814559-7945-48c7-bb2c-a5929a768b32"
}
    \end{minted}
    \caption[Query 1: Response header Microsoft Graph]{Response van de eerste query via Microsoft Graph Explorer.}
    \label{Q1MSGRH}
\end{listing}

\clearpage

\section{Query 2: Gebruiker aanmaken}

\subsection{Azure AD Graph}

\subsubsection{Request}

\begin{itemize}
    \item \Ac{HTTP}-method: POST
    \item \ac{URL}: https://graph.windows.net/ffa43659-...-838af35d1353/users
    \item \Ac{API}-version: 1.6
\end{itemize}

\subsubsection{Request body}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=2mm,
        baselinestretch=1.2,
        fontsize=\scriptsize,
        linenos
        ]  
        {json}
{
    "accountEnabled": true,
    "displayName": "Alex Wu",
    "mailNickname": "AlexW",
    "passwordProfile": {
        "password": "Test1234",
        "forceChangePasswordNextLogin": false
    },
    "userPrincipalName": "Alex@25ky3d.onmicrosoft.com"
}
    \end{minted}
    \caption[Query 2: Request body Microsoft Graph]{Request body van de tweede query via Azure \Ac{AD} Graph Explorer.}
    \label{Q2AADRQB}
\end{listing}

\clearpage

\subsubsection{Response body}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=2mm,
        baselinestretch=1.2,
        fontsize=\tiny,
        linenos
        ]  
        {json}
{
    "odata.metadata":  "https://graph.windows.net/ffa43659-...-838af35d1353/$metadata#directoryObjects/@Element",
    "odata.type": "Microsoft.DirectoryServices.User",
    "objectType": "User",
    "objectId": "5c9ab483-c9b4-4ab3-a857-4763c055ef53",
    "deletionTimestamp": null,
    "accountEnabled": true,
    "ageGroup": null,
    "assignedLicenses": [],
    "assignedPlans": [],
    "city": null,
    "companyName": null,
    "consentProvidedForMinor": null,
    "country": null,
    "createdDateTime": null,
    "creationType": null,
    "department": null,
    "dirSyncEnabled": null,
    "displayName": "Alex Wu",
    "employeeId": null,
    "facsimileTelephoneNumber": null,
    "givenName": null,
    "immutableId": null,
    "isCompromised": null,
    "jobTitle": null,
    "lastDirSyncTime": null,
    "legalAgeGroupClassification": null,
    "mail": null,
    "mailNickname": "AlexW",
    "mobile": null,
    "onPremisesDistinguishedName": null,
    "onPremisesSecurityIdentifier": null,
    "otherMails": [],
    "passwordPolicies": null,
    "passwordProfile": null,
    "physicalDeliveryOfficeName": null,
    "postalCode": null,
    "preferredLanguage": null,
    "provisionedPlans": [],
    "provisioningErrors": [],
    "proxyAddresses": [],
    "refreshTokensValidFromDateTime": "2023-05-06T10:53:45.6717827Z",
    "showInAddressList": null,
    "signInNames": [],
    "sipProxyAddress": null,
    "state": null,
    "streetAddress": null,
    "surname": null,
    "telephoneNumber": null,
    "usageLocation": null,
    "userIdentities": [],
    "userPrincipalName": "Alex@25ky3d.onmicrosoft.com",
    "userState": null,
    "userStateChangedOn": null,
    "userType": "Member"
}
    \end{minted}
    \caption[Query 2: Response body Microsoft Graph]{Response body van de tweede query via Azure \Ac{AD} Graph Explorer.}
    \label{Q2AADRB}
\end{listing}

\clearpage

\subsubsection{Response header}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=2mm,
        baselinestretch=1.2,
        fontsize=\scriptsize,
        linenos
        ]  
        {json}
{
    "cache-control": "no-cache",
    "client-request-id": "b47a729f-c944-44a1-a6a3-5f9d84b0b73f",
    "content-length": "1387",
    "content-type": "application/json; odata=minimalmetadata; streaming=true; charset=utf-8",
    "expires": "-1",
    "ocp-aad-session-key": "EYQrEhc2N...S1buL6cO8",
    "pragma": "no-cache",
    "request-id": "40d52611-5733-411b-aa59-1e76643a6ff4"
}
    \end{minted}
    \caption[Query 2: Response body Microsoft Graph]{Response body van de tweede query via Azure \Ac{AD} Graph Explorer.}
    \label{Q2AADRH}
\end{listing}

\subsection{Microsoft Graph}

\subsubsection{Request}

\begin{itemize}
    \item \Ac{HTTP}-method: POST
    \item \ac{API}-version: 1.0
    \item \Ac{URL}: https://graph.microsoft.com/v1.0/users
\end{itemize}

\subsubsection{Request body}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=2mm,
        baselinestretch=1.2,
        fontsize=\scriptsize,
        linenos
        ]  
        {json}
{
    "accountEnabled": true,
    "displayName": "Alex Wu",
    "mailNickname": "AlexW",
    "passwordProfile": {
        "password": "Test1234",
        "forceChangePasswordNextSignin": false
    },
    "userPrincipalName": "Alex@25ky3d.onmicrosoft.com"
}
    \end{minted}
    \caption[Query 2: Request body Microsoft Graph]{Request body van de tweede query via Microsoft Graph Explorer.}
    \label{Q2MSGRQB}
\end{listing}

\clearpage

\subsubsection{Response body}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=2mm,
        baselinestretch=1.2,
        fontsize=\scriptsize,
        linenos
        ]  
        {json}
{
    "@odata.context": "https://graph.microsoft.com/v1.0/$metadata#users/$entity",
    "id": "bc521ac5-ab90-4427-880d-c1c52ffe3ee7",
    "businessPhones": [],
    "displayName": "Alex Wu",
    "givenName": null,
    "jobTitle": null,
    "mail": null,
    "mobilePhone": null,
    "officeLocation": null,
    "preferredLanguage": null,
    "surname": null,
    "userPrincipalName": "Alex@25ky3d.onmicrosoft.com"
}
    \end{minted}
    \caption[Query 2: Response body Microsoft Graph]{Response body van de tweede query via Microsoft Graph Explorer.}
    \label{Q2MSGRB}
\end{listing}

\subsubsection{Response header}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=2mm,
        baselinestretch=1.2,
        fontsize=\scriptsize,
        linenos
        ]  
        {json}
{
    "cache-control": "no-cache",
    "client-request-id": "dce37693-434c-e47b-0cf5-b08bc11752fb",
    "content-type": "application/json;odata.metadata=minimal;
        odata.streaming=true;IEEE754Compatible=false;charset=utf-8",
    "location": "https://graph.microsoft.com/v2/ffa43659-...-838af35d1353/directoryObjects/
        bc521ac5-...-c1c52ffe3ee7/Microsoft.DirectoryServices.User",
    "request-id": "fab6e8dc-c90c-4377-a54f-b67034f3a07e"
}
    \end{minted}
    \caption[Query 2: Response header Microsoft Graph]{Response header van de tweede query via Microsoft Graph Explorer.}
    \label{Q2MSGRH}
\end{listing}

\clearpage

\section{Query 3: Gebruiker aanpassen}

\subsection{Azure AD Graph}

\subsubsection{Request}

\begin{itemize}
    \item \Ac{HTTP}-method: PATCH
    \item \ac{URL}: https://graph.windows.net/ffa...353/users/Alex@25ky3d.onmicrosoft.com
    \item \Ac{API}-version: 1.6
\end{itemize}

\subsubsection{Request body}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=2mm,
        baselinestretch=1.2,
        fontsize=\scriptsize,
        linenos
        ]  
        {json}
{
    "displayName": "Alex A. Wu"
}
    \end{minted}
    \caption[Query 3: Request body Azure AD Graph]{Request body van de derde query via Azure \Ac{AD} Graph Explorer.}
    \label{Q3AADRQB}
\end{listing}

\subsubsection{Response}

Geen response beschikbaar. Bij een PATCH-request wordt er bij een succesvolle verwerking geen response meegegeven. Als bewijs dat de query werd uitgevoerd wordt volgende screenshot meegegeven. 

% TODO: instert photo

\subsection{Microsoft Graph}

\subsubsection{Request}

\begin{itemize}
    \item \Ac{HTTP}-method: PATCH
    \item \ac{API}-version: 1.0
    \item \Ac{URL}: https://graph.microsoft.com/v1.0/users/\{407074b1-...-41b76fbd7b67\}
\end{itemize}

\subsubsection{Request body}

\begin{listing}[!h]
    \begin{minted}
        [
        frame=lines,
        framesep=2mm,
        baselinestretch=1.2,
        fontsize=\scriptsize,
        linenos
        ]  
        {json}
{
    "displayName": "Alex A. Wu"
}
    \end{minted}
    \caption[Query 3: Request body Microsoft Graph]{Request body van de derde query via Microsoft Graph Explorer.}
    \label{Q3MSGRQB}
\end{listing}

\subsubsection{Response}

Geen response beschikbaar. Bij een PATCH-request wordt er bij een succesvolle verwerking geen response meegegeven. Als bewijs dat de query werd uitgevoerd kan ... geraadpleegd worden. % TODO ... vervangen met verwijzing naar vorige onderdeel 

\clearpage

\section{Query 4: Gebruiker verwijderen}

\subsection{Azure AD Graph}

\subsubsection{Request}

\begin{itemize}
    \item \Ac{HTTP}-method: DELETE
    \item \ac{URL}: https://graph.windows.net/ffa...353/users/Alex@25ky3d.onmicrosoft.com
    \item \Ac{API}-version: 1.6
\end{itemize}

\subsubsection{Response}

Geen response beschikbaar. Bij een DELETE-request wordt er bij een succesvolle verwerking geen response meegegeven. Als bewijs dat de query werd uitgevoerd wordt volgende screenshot meegegeven. 

% TODO: instert photo

\subsection{Microsoft Graph}

\subsubsection{Request}

\begin{itemize}
    \item \Ac{HTTP}-method: DELETE
    \item \ac{API}-version: 1.0
    \item \Ac{URL}: https://graph.microsoft.com/v1.0/users/\{407074b1-...-41b76fbd7b67\}
\end{itemize}

\subsubsection{Response}

Geen response beschikbaar. Bij een DELETE-request wordt er bij een succesvolle verwerking geen response meegegeven. Als bewijs dat de query werd uitgevoerd kan ... geraadpleegd worden. % TODO ... vervangen met verwijzing naar vorige onderdeel

% ---
% CHAPTER
% ---

\chapter{Audit-script PowerShell-scripts}%
\label{ch:PowerShell-scripts}

Hier komen de 20 onderdelen + connect MS Graph scripts